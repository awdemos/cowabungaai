# yaml-language-server: $schema=https://raw.githubusercontent.com/defenseunicorns/uds-cli/v0.14.0/tasks.schema.json

variables:
  - name: VERSION
    description: "Explicitly set this to mutate the version away from the latest tagged release (e.g., `dev`)"
    # x-release-please-start-version
    default: "0.13.1"
    # x-release-please-end
  - name: FLAVOR
    description: "Explicitly set this to mutate the flavor away from `upstream` (e.g., `registry1`)"
    default: "upstream"
  - name: ARCHITECTURE
    description: "Explicitly set this to mutate the architecture away from `amd64` (e.g., `arm64`)"
    default: "amd64"

  - name: LOCAL_REGISTRY_NAME
    description: "Explicitly set this to mutate the local registry name away from `registry`"
    default: "registry"
  - name: LOCAL_REGISTRY_PORT
    description: "Explicitly set this to mutate the local registry port away from `5000` (e.g., `5001` for MacOS)"
    default: "5000"

includes:
  #########################
  # UDS COMMON TASK IMPORTS
  #########################
  - badge-common: https://raw.githubusercontent.com/defenseunicorns/uds-common/82e63be82766a2e550a847af904b2d738c9d3478/tasks/badge.yaml

  ###########################
  # LEAPFROGAI-SPECIFIC TASKS
  ###########################
  - badge: ./tasks/badge.yaml
  - create: ./tasks/create.yaml
  - publish: ./tasks/publish.yaml

tasks:
  #######
  # BADGE
  #######
  - name: nightly-uds-badge-verification
    description: "Runs in a pipeline and produces a report for archiving"
    actions:
      - description: "Create Reports Directory"
        cmd: |
          mkdir -p reports
      - description: "Run UDS Badge Verification Task"
        cmd: |
          uds run badge:verify-uds-badge-cpu --no-progress 2>&1 | tee ./reports/intermediate-report.txt
      - description: "Clean Up Final Report"
        cmd: |
          python3 .github/scripts/uds_verification_report.py | tee ./reports/final-report.txt
