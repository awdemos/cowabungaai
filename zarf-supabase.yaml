# yaml-language-server: \$schema=https://raw.githubusercontent.com/defenseunicorns/zarf/main/zarf.schema.json
kind: ZarfPackageConfig
metadata:
  name: supabase
  version: '###ZARF_PKG_TMPL_IMAGE_VERSION###'
  description: >
    supabase instance and all of its dependencies (using official Supabase images and UDS-compatible configuration)

constants:
  - name: DASHBOARD_USERNAME
    description: The dashboard's (Supabase studio) default username
    value: supabase-admin
  - name: EXTERNAL_KEYCLOAK_CLIENT_ID
    description: 'External keycloak client value'
    value: "uds-supabase"
  - name: EXTERNAL_KEYCLOAK_REDIRECT_URL
    description: 'Keycloak redirect url'
    value: "https://supabase-kong.uds.dev/auth/v1/callback"
  - name: EXTERNAL_KEYCLOAK_URL
    description: 'External keycloak url'
    value: "https://keycloak.admin.uds.dev/realms/uds"
  - name: IMAGE_VERSION
    value: '###ZARF_PKG_TMPL_IMAGE_VERSION###'

variables:
  - name: DOMAIN
    default: "uds.dev"
  - name: ENABLE_AUTH
    description: 'Enable Supabases built-in authentication and authorization parts'
    default: "true"
  - name: ENABLE_META
    description: 'Enable restful API for managing Postgres, fetch tables, add roles, and run queries'
    default: "true"
  - name: ENABLE_REALTIME
    description: 'Enables API for sending and receiving messages between clients in realtime in addition to listening for db changes'
    default: "true"
  - name: ENABLE_REST
    description: 'Enable autogenerated high level rest API for interacting with database'
    default: "true"
  - name: ENABLE_STORAGE
    description: 'Enable Supabase object store'
    default: "true"
  - name: ENABLE_STUDIO
    description: 'Enable Supabase studio dashboard'
    default: "true"
  - name: ENABLE_KONG
    description: 'Enable API gateway that automatically handles routing between Supabase workloads'
    default: "true"
  - name: ENABLE_POSTGRES
    description: 'Enable built-in postgres db to store account information and serve as a backend db for integrating applications'
    default: "false"

components:
  - name: supabase
    required: true
    charts:
      - name: supabase
        namespace: leapfrogai
        url: oci://ghcr.io/supabase-community/supabase-kubernetes
        releaseName: supabase
        version: 5.1.0
        valuesFiles:
          - "/Users/a/code/cowabungaai/packages/supabase/values.yaml"
